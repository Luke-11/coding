\usepackage{currfile}

\makeatletter
\newcounter{secid}
\newwrite\secidout
\immediate\openout\secidout=\jobname.secid

% Write: <secid>|<file>|<line>
% Use \currfilepath which gives path relative to current working directory
% (where LaTeX was run from, typically the main document directory)
\newcommand{\writesecid}{%
  \stepcounter{secid}%
  \begingroup
    \edef\temp{\thesecid|\currfilepath|\the\inputlineno}%
    \immediate\write\secidout{\temp}%
  \endgroup
}

% Patch \addcontentsline to inject secid into .toc
\let\orig@addcontentsline\addcontentsline
\renewcommand{\addcontentsline}[3]{%
  \writesecid
  % prepend [secid=<n>] to the toc body
  \orig@addcontentsline{#1}{#2}{[secid=\thesecid]#3}%
}
\makeatother

